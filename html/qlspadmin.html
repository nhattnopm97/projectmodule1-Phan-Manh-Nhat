<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh sách sản phẩm</title>
</head>
<style>
    #btnhiden {
        display: none;
    }
</style>

<body>
    <button onclick="dn()">Đăng nhập</button>
    <button onclick="dk()">Đăng ký</button>
    <h2>Nhập thông tin sản phẩm</h2>
    <!-- /*tên, giá, mã, mô tả -->
    <label for="">Tên sản phẩm</label>
    <input id="ten" type="text" placeholder="iphone 14 promax"><br>
    <label for="">Nhập giá</label>
    <input id="gia" type="text" placeholder="35.000.000"><br>


    <label for="">Mô tả</label>
    <input id="moTa" type="text" placeholder="trắng, đen, to, nhỏ,..."><br>
    <button id="btnSave" onclick="save()">Lưu thông tin</button>
    <button id="btnhiden" onclick="updateSP()">Cập nhật</button>
    <table id="table" border="1px">

    </table>
    <h2>Tìm kiếm theo tên sản phẩm</h2>
    <input id="timKiem" type="text" placeholder="iphonex">
    <button onclick="timKiem()">Tìm kiếm</button>
    <table id="tbsearch"></table>
    <script>

        //khi bấm vào nút lưu sản phẩm, lưu sản phẩm lên và sinh id cho sản phẩm
        let dsSP = JSON.parse(localStorage.getItem("dsSP"));
        function save() {
            let ten = document.getElementById("ten").value;
            let gia = document.getElementById("gia").value;
            const uid = function () {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }
            let moTa = document.getElementById("moTa").value;
            let ma = uid();
            let sanPham = {
                ten: ten,
                gia: gia,
                ma: ma,
                moTa: moTa,
                sl:1
            }
            /*flag = JSON.parse(localStorage.getItem("flag"));
            if (flag != null) {
                sanPham = {
                    ten: ten,
                    gia: gia,
                    ma: ma,
                    moTa: moTa
                }
                localStorage.removeItem("flag");
                dsSP.splice(flag, 1, sanPham);
                localStorage.setItem("dsSP", JSON.stringify(dsSP));
                themVaoBang();
                return;
            }*/
            if (dsSP == null) {
                dsSP = [];
            }
            dsSP.push(sanPham);
            localStorage.setItem("dsSP", JSON.stringify(dsSP));
            themVaoBang();
        }


        function themVaoBang() {
            let kq =
                `
            <tr>
                <td>STT</td>
                <td>Tên sản phẩm</td>
                <td>Giá</td>
                <td>Mã sản phẩm</td>
                <td>Mô tả</td>
                <td>Edit</td>
                <td>Xóa</td>
            </tr>
            `;
            for (i = 0; i < dsSP.length; i++) {
                kq +=
                    `
                <tr>
                    <td>${i + 1}</td>
                    <td>${dsSP[i].ten}</td>
                    <td>${dsSP[i].gia}</td>
                    <td>${dsSP[i].ma}</td>
                    <td>${dsSP[i].moTa}</td>
                    <td><button onclick="ed(${i})">Edit</button></td>
                    <td><button onclick="del(${i})">Xóa</button></td>
                </tr>
                `;
            }
            document.getElementById("table").innerHTML = kq;
            document.getElementById("ten").value = "";
            document.getElementById("gia").value = "";
            document.getElementById("moTa").value = "";
        }
        themVaoBang();
        function del(id) {
            dsSP.splice(id, 1);
            localStorage.setItem("dsSP", JSON.stringify(dsSP));
            themVaoBang();
        }

        //khi bấm vào nút edit thì ẩn nút lưu sản phẩm, hiện nút update sản phẩm cũ.
        function ed(id) {
            document.getElementById("ten").value = dsSP[id].ten;
            document.getElementById("gia").value = dsSP[id].gia;
            document.getElementById("moTa").value = dsSP[id].moTa;
            const idSPNed = dsSP[id].ma;
            let idAndMa = [id, idSPNed];
            localStorage.setItem("flag", JSON.stringify(idAndMa));
            let hidenbutton = document.getElementById("btnSave");
            hidenbutton.style.display = "none";
            let showHidenBtn = document.getElementById("btnhiden");
            showHidenBtn.style.display = "block";
        }


        //Tìm kiếm theo tên sản phẩm
        function timKiem() {
            let ndTK = document.getElementById("timKiem").value;
            let kqTK = "";
            for (j = 0; j < dsSP.length; j++) {
                if (dsSP[j].ten.toLowerCase().includes(ndTK.toLowerCase())) {
                    kqTK +=
                        `
                    <tr>
                        <td>${j + 1}</td>
                        <td>${dsSP[j].ten}</td>
                        <td>${dsSP[j].gia}</td>
                        <td>${dsSP[j].ma}</td>
                        <td>${dsSP[j].moTa}</td>
                    </tr>
                    `
                }
                document.getElementById("tbsearch").innerHTML = kqTK;
            }
        }

        //xóa dữ liệu cũ và cập nhật dữ liệu mới với mã là mã cũ vào danh sách sản phẩm lưu trên local, chuyển nút cập nhật thành nút lưu
        function updateSP() {
            flag = JSON.parse(localStorage.getItem("flag"));
            if (flag != null) {
                let gia = document.getElementById("gia").value;
                let ten = document.getElementById("ten").value;
                let ma = flag[1];
                let moTa = document.getElementById("moTa").value;

                sanPham = {
                    ten: ten,
                    gia: gia,
                    ma: ma,
                    moTa: moTa,
                    sl:1,
                }
                localStorage.removeItem("flag");
                dsSP.splice(flag[0], 1, sanPham);
                localStorage.setItem("dsSP", JSON.stringify(dsSP));
                themVaoBang();
                let hidenbutton = document.getElementById("btnSave");
                hidenbutton.style.display = "block";
                let showHidenBtn = document.getElementById("btnhiden");
                showHidenBtn.style.display = "none";
            }
        }
    </script>
</body>

</html>